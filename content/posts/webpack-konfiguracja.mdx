---
title: 'Webpack 4 - loadery, pluginy i niestandardowa konfiguracja'
category: 'Webpack'
publishedAt: '19-06-2020'
isPublished: true
popular: false
excerpt: 'W poprzednim wpisie poznae podstawy Webpacka, dzisiaj wykorzystamy t wiedzw praktyc i stworzymy penoprawn konfiguracj projektu.'
---

Cze 

W poprzednim wpisie poznae podstawy **Webpacka**, dzisiaj wykorzystamy t wiedzw praktyc i stworzymy **konfiguracj projektu**.

## Instalacja

Nie tramy czasu na instalacj, sklonujmy repo, kt贸re utworzyem w poprzednim wpisie:

```bash
git clone https://github.com/Frontlive/webpack-pierwsze-kroki.git
```

## Wstpna konfiguracja

Stw贸rzmy teraz plik `webpack.config.js`:

```bash
touch webpack.config.js
```

Plik konfiguracyjny Webpacka to w ostatecznoci kod JavaScriptu, wic nic nie stoi nam na przeszkodzie, 偶eby zrobi w nim funkcj.

```js
module.exports = ({ mode }) => ({
  mode,
});
```

Pamitacie jak podawalimy `mode` w poprzednim wpisie do package.json? Mo偶emy, w tym samym pliku, utworzyzmienn i **w zale偶noci od trybu** np. adowa odpowiednie konfiguracje, ale do tego przejd藕iemy za moment.

```json
"scripts": {
    "webpack": "webpack",
    "dev": "npm run webpack -- --env.mode development --watch",
    "prod": "npm run webpack -- --env.mode production"
  },
```

## Konfiguracja serwera

Zacznijmy od zainstalowania pluginu `html-webpack-plugin`.

```bash
npm install --save-dev html-webpack-plugin
```

Importujemy go w naszym pliku konfiguracyjnym, u偶ywajc skadni CommonJS, jako szablon dla wygenerowanego pliku dajemy przykadowy plik `index.html` znajdujcy si w katalogu `src/`:

```js
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = ({ mode }) => ({
  mode,
  output: {
    filename: 'bundle.js',
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: './src/index.html',
    }),
  ],
});
```

Zainstalujmy teraz serwer deweloperski i dodajmy odpowiedni skrypt do `package.json`:

```bash
npm install --save-dev webpack-dev-server
```

```json
"scripts": {
    "webpack-dev-server": "webpack-dev-server",
    "webpack": "webpack",
    "dev": "npm run webpack-dev-server -- --env.mode development --watch",
    "prod": "npm run webpack -- --env.mode production"
  },
```

Zbudujmy teraz nasz bundle i odpalmy serwer:

```bash
 npm run prod && npm run dev
```

## Rozdzielenie tryb贸w

Mo偶e zdarzy si tak, 偶e bdziesz potrzebowa **osobnej konfiguracji** dla trybu `prod` i `dev`, w takim przypadku przychodzi nam z pomoc wtyczka `webpack-merge`:

```bash
npm install --save-dev webpack-merge
```

Po zainstalowaniu stw贸rz folder w katalogu g贸wnym o nazwie `build-utils`, a w nim `webpack.production.js` i `webpack.development.js`. Tutaj znajd si nasze Webpackowe konfiguracje.

```js
// webpack.production.js & webpack.development.js
module.exports = () => ({});

// webpack.config.js
const HtmlWebpackPlugin = require('html-webpack-plugin');
const webpackMerge = require('webpack-merge');

const modeConfig = (env) => require(`./build-utils/webpack.${env}`)(env);

module.exports = ({ mode } = { mode: 'production' }) =>
  webpackMerge(
    {
      mode,
      output: {
        filename: 'bundle.js',
      },
      plugins: [new HtmlWebpackPlugin()],
    },
    modeConfig(mode),
  );
```

Importujemy sam paczk, tworzymy funkcj, kt贸ra bdzie zacigaa nasz plik na podstawie `mode`.

> U偶ywamy tutaj destrukturyzacji i pocztkowych wartoci parametr贸w

Wykorzystajmy te mo偶liwoci i nadajmy inny `output` do trybu produkcyjnego.

```js
module.exports = () => ({
  output: {
    filename: '[chunkhash].js',
  },
});
```

Stworzylimy customow hashowan cie偶k dla pliku wyjciowego.

## Sass

Jak mo偶emy wykorzysta Webpacka z Sassem? U偶y loader贸w!

Instalacja:

```bash
npm install sass-loader sass style-loader css-loader mini-css-extract-plugin --save-dev
```

Stw贸rzmy teraz podstawowy plik z rozszerzeniem `.scss`:

```bash
cd src && touch main.scss
```

Dodajmy style:

```scss
$body-color: #f2ff2a;

body {
  background-color: $body-color;
}
```

Do naszego `webpack.development.js` dopisujemy odpowiednie loadery:

```js
module: {
    rules: [
      {
        test: /\.s[ac]ss$/i,
        use: ["style-loader", "css-loader", "sass-loader"],
      },
    ],
  },
```

Teraz jeli spr贸bujesz odpali cokolwiek, prawdopodobnie zobaczysz bd. Musimy jeszcze zaimportowa plik css w naszym `entry point`, czyli w naszym przypadku w `index.js`. Dzieje si to dlatego, 偶e Webpack ka偶dy nasz plik traktuje jako **modu**.

```js
// index.js
import hello from './welcome';
import { multiplyByTwo } from './multiply';
import './main.scss';
console.log(hello, multiplyByTwo(2));
```

Okej, ale to nie bdzie dziaa na produkcji, chcemy aby nasze moduy css trafiay nie do zbundlowanego pliku `.js`, lecz do osobnego pliku `.css`. Dodajmy wic odpowiedni plugin:

```bash
npm install mini-css-extract-plugin --save-dev
```

_Na produkcji_ potrzebujemy doda nasz plugin i zmieni `style-loader` na `MiniCssExtractPlugin.loader`:

```js
const MiniCssExtractPlugin = require('mini-css-extract-plugin');
module.exports = () => ({
  output: {
    filename: '[chunkhash].js',
  },
  module: {
    rules: [
      {
        test: /\.s[ac]ss$/i,
        use: [MiniCssExtractPlugin.loader, 'css-loader', 'sass-loader'],
      },
    ],
  },
  plugins: [new MiniCssExtractPlugin()],
});
```

Jeli wszystko poszo po naszej myli, powiniene zobaczy sw贸j plik css w folderze `dist/`.

## Babel

Na sam koniec, zainstalujmy [Babela](https://babeljs.io/), kt贸ry kompiluje wsp贸czesny JavaScript do starszych wersji.

```bash
npm install babel-loader @babel/core @babel/preset-env --save-dev
```

Dodajmy odpowiednie reguy do `webpack.production.js`:

```js
  {
        test: /\.m?js$/,
        exclude: /(node_modules)/,
        use: {
          loader: "babel-loader",
          options: {
            presets: ["@babel/preset-env"],
          },
        },
      },
```

Za pomoc wyra偶e regularnych sprawdzamy rozszerzenie pliku, dziki `exclude` wykluczamy `node_modules`. Nastpnie zaadowujemy odpowiedni **loader** i dodatkowe opcje.

## Podsumowanie

Dziki za wytrwanie do koca, to bya podstawowa konfiguracja w moim wykonaniu, cay kod mo偶ecie znale藕 na [githubie](https://github.com/Frontlive/webpack-projekt). Zachcam do dalszego zgbiania Webpacka, jest masa **super plugin贸w**, kt贸re mo偶ecie znale藕 w [dokumentacji](https://webpack.js.org/plugins/) i doda do **swojego projektu**.

Do usyszenia!

### 殴r贸da

- [Webpack docs](https://webpack.js.org/)
