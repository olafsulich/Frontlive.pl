---
title: 'GraphQL + TypeScript - wygeneruj sobie typy!'
category: 'GraphQL'
publishedAt: '28-08-2020'
isPublished: true
popular: false
image: '/images/graphql-generator/graphql-generator.png'
excerpt: 'Lubimy zaoszczdza czas, a jednoczenie zrobi co dobrze. Tak samo jest w przypadku programowania. Poznaj GraphQL Code Generator - narzdzie, kt贸re zaoszczdza czas i zapewnia TypeScriptowe typy!'
---

Cze 

Wracamy, po kr贸tkiej przerwie do GraphQLa. Tym chciabym Ci przybli偶y wietne narzdzie jakim jest [GraphQL Code Generator](https://graphql-code-generator.com/). Dziki niemu zaoszczdzimy czas i na postawie GraphQLowej **schemy** wygenerujemy w peni poprawne TypeScriptowe **typy**, Reaktowe **komponenty**, czy te偶 **hooki**!

## Instalacja

Zacznijmy od zainstalowania generatora:

```bash
npm install --save-dev @graphql-codegen/cli
```

## Ustawienia

Gdy instalacje mamy ju偶 za sob, dodajmy odpowiedni skrypt do `package.json`:

```json
{
  "scripts": {
    "generate": "graphql-codegen"
  }
}
```

## Plik konfiguracyjny

Stw贸rzmy plik `codegen.yml`:

```bash
touch codegen.yml
```

To tutaj dzieje sicaa **magia**, mo偶emy tutaj poda masopcji, ale podstawowymi bd `schema`, `documents` i `generates`.

- `schema` - cie偶ka do Twojej _schemy_
- `documents` - cie偶ka do dokument贸w, kt贸re opisuj zapytania, mutacje, subskrypcje i fragmenty
- `generates` - opisuje co ma gdzie zosta wygenerowane i z jakich plugin贸w ma korzysta

## TypeScript

Zacznijmy od podstawowego poczenia generatora z **TypeScriptem**, 偶eby cao dziaaa musimy zainstalowa odpowiedni **plugin**:

```bash
npm install --save-dev @graphql-codegen/typescript
```

Nastpnie, stw贸rzmy **scheme**, kt贸ra bdzie opisywa u偶ytkownika.

```ts
type Language {
  name: String!
}

type User {
  name: String!
  age: Int!
  id: ID!
  languages: [Language]!
}
```

Super, teraz rozbudujemy nasz **plik konfiguracyjny**, tak abymy po odpaleniu komendy `generate` dostali **gotowe typy** na podstawie powy偶szego schematu.

```yml
schema: './schema.graphql'
generates:
  generated.ts:
    plugins:
      - typescript
```

W `schema` podalimy cie偶k do naszego schematu, a w `generates` ustawilimy plik wyjciowy dla typ贸w - `generated.ts`.

Wystarczy teraz, 偶e odpalimy komend `generate` i powinnimy zobaczy plik `generated.ts`:

```bash
npm run generate
```

Ten przykad by bardzo prosty i raczej mao u偶yteczny, albowiem najczciej bdziemy _zaciga_ nasz schemat z backendu, co wtedy? Nic nie stoi nam na przeszkodzie, 偶eby poda po prostu do niego cie偶k.

```yml
schema: 'http://localhost:3000/graphql'
```

Schemat贸w mo偶emy poda **wiele** i na **r贸偶nych poziomach**, na przykad, chcemy stworzy dwa pliki z dw贸ch niezale偶nych od siebie schemat贸w, nic trudnego!

```yml
generates:
  ./generated1.ts:
    schema: ./schema.graphql
    plugins:
      - typescript
  ./generated1.ts:
    schema: http://localhost:3000/graphql
    plugins:
      - typescript
```

Wspominaem przed chwil o `documents` czyli o plikach gdzie przechowujemy nasze zapytania, mutacje czy te偶 fragmenty, sp贸jrzmy na przykadzie.

Na pocztek, stw贸rzmy plik `schema.graphql` z naszym schematem:

```graphql
type Query {
  animal(id: ID!): Animal
  allAnimals: [Animal]
}

type Animal {
  id: ID!
  name: String!
  age: Int!
}
```

Chcemy stworzy **zapytanie**, kt贸re bdzie pobierao danego zwierzaka na podstawie `id`, dokadnie tak, jak podalimy na powy偶szym **schemacie**.

Utw贸rzmy plik `getAnimal.graphql`

```graphql
query GetAnimal($animalId: ID!) {
  animal(id: $animalId) {
    ...AnimalFields
  }
}

fragment AnimalFields on Animal {
  id
  name
}
```

Zainstalujmy odpowiedni **plugin** i zmodyfikujmy plik konfiguracyjny:

```bash
npm install --save-dev @graphql-codegen/typescript-operations
```

```yml
schema: 'schema.graphql'
documents: 'getAnimal.graphql'
generates:
  operations-types.ts:
    plugins:
      - typescript
      - typescript-operations
```

Voil dostalimy wygenerowane typy na podstawie **zapytania** i **schematu**.

## React

Wspominaem na pocztku, 偶e za pomoc tego narzdzia mo偶emy **wygenerowa hooki**, kt贸re bd w peni otypowane, nie ma co zwleka, bierzemy si do pracy!

Zacznijmy od zainstalowania **pluginu**:

```bash
npm install --save-dev @graphql-codegen/typescript-react-apollo
```

Nie tramy czasu i zostawmy nasz schemat i operacje **takimi jakie s**, a w pliku konfiguracyjnym dodajmy zainstalowany plugin.

```yml
schema: 'schema.graphql'
documents: 'getAnimal.graphql'
generates:
  operations-types.ts:
    plugins:
      - typescript
      - typescript-operations
      - typescript-react-apollo
```

Jeli wygenerujesz teraz kod i spojrzysz do wygenerowanego pliku, na samym dole zobaczysz **wygenerowane hooki**!

```ts
export function useGetAnimalQuery(
  baseOptions?: Apollo.QueryHookOptions<GetAnimalQuery, GetAnimalQueryVariables>,
) {
  return Apollo.useQuery<GetAnimalQuery, GetAnimalQueryVariables>(GetAnimalDocument, baseOptions);
}
export function useGetAnimalLazyQuery(
  baseOptions?: Apollo.LazyQueryHookOptions<GetAnimalQuery, GetAnimalQueryVariables>,
) {
  return Apollo.useLazyQuery<GetAnimalQuery, GetAnimalQueryVariables>(
    GetAnimalDocument,
    baseOptions,
  );
}
```

Dostalimy dwa **otypowe** hooki, gdyby chcia u偶y mutacji czy te偶 subskrypcji to nie ma najmniejszego problemu, dziaa to na tej samej zasadzie.

Jak mo偶emy z nich skorzysta? Dokadnie tak jak z dostarczanych przez apollo hook贸w `useQuery` i `useLazyQuery`, wystarczy je zaimportowa.

```tsx
import { useGetAnimalQuery } from "operations-types.ts";

const Animal = () => {
  const { data } = useGetAnimalQuery(...);
};
```

## TypedDocumentNode

Generowanie hook贸w jest super, ale to zawsze du偶o dodatkowego kod. `TypedDocumentNode` wskakuje na poziom wy偶ej i nie do, 偶e **skraca** nam wygenerowany kod to jeszcze dziki niemu TypeScript bdzie **podpowiada** i **uzupenia** typy na podstawie ustalonych wczeniej operacji!

Zamiast wygenerowanych hook贸w dostajemy gotowe do wykorzystania **typy**:

<Image
  src="/images/graphql-generator/TypedDocumentNode.gif"
  alt="U偶ycie TypeDocumentNode w praktyce"
/>

## Podsumowanie

[GraphQL Code Generator](https://graphql-code-generator.com/) jest na prawd pot偶nym narzdziem, kt贸re niewyobra偶alnie uatwia nam pracz GraphQLem i TypeScriptem, odwala ono poow _brudnej_ roboty za nas!

Generowa mo偶emy zar贸wno typy dla **frontendu** jak i **backendu**. Hooki w **Reakcie**, composition components we **Vue**, komponenty w **Angularze** to tylko niekt贸re opcje, warto si przyjrze temu narzdziu bli偶ej, polecam z caego serca 

### 殴r贸da

- [GraphQL Code Generator](https://graphql-code-generator.com/)
