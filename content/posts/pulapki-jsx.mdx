---
title: 'PuÅ‚paki konstrukcji warunkowych w React i JSX'
category: 'React'
publishedAt: '14-02-2022'
isPublished: false
popular: false
image: '/images/pulapki-jsx/thumbnail.png'
excerpt: 'React, JSX i renderowanie warunkowe - to nie moÅ¼e siÄ™Â skoÅ„czyÄ‡ dobrze! SprawdÅº jakie puÅ‚apki czyhajÄ… na nas podczas korzystania z operatorÃ³w logicznych (i nie tylko)'
---

Warunkowe renderowanie w React, w przeciwieÅ„stwie do takiego Vue.js moÅ¼e odbywaÄ‡ siÄ™ za pomocÄ… [operatorÃ³w logicznych](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_AND). Takie rozwiÄ…zanie to w teorii Å‚atwiejsza do nauczenia skÅ‚adania, z drugiej strony niesie ono za sobÄ… szereg puÅ‚apek, na ktÃ³re warto zwracaÄ‡ uwagÄ™.

## StrzeÅ¼Â siÄ™Â zera

Bardzo czÄ™sto zdarza nam siÄ™Â korzystaÄ‡ z operatora AND (`&&`), Å¼eby wyÅ›wietliÄ‡ jakiÅ› kawaÅ‚ek JSX. ZaÅ‚Ã³Å¼my, Å¼e tworzymy komponent odpowiadajÄ…cy za wyÅ›wietlanie ceny i iloÅ›ci danego przedmiotu w koszyku. IloÅ›Ä‡Â jest niezbÄ™dna do wyÅ›wietlenia caÅ‚ego komponentu, a przez to, Å¼e pochodzi z zewnÄ™trznego serwisu moÅ¼e mieÄ‡ wartoÅ›Ä‡Â typu `number` lub byÄ‡ pod postaciÄ… `undefined`:

```tsx
quantity && <PriceAndQuantity quantity={quantity} />;
```

JeÅ›li iloÅ›Ä‡Â bÄ™dzie `undefined`, to po prostu nie wyÅ›wielimy komponentu. A co jeÅ›li jej wartoÅ›Ä‡ bÄ™dzie `0`? SpodziewalibyÅ›my siÄ™, Å¼e tak jak w przypadku `undefined` komponent nie zostanie wyrenderowany, w koÅ„cu `0` jest _falsy_, dzieje siÄ™Â jednak inaczej... Do naszego drzewa DOM _przecieka_ faktyczne `0`! Ale jak?

WÅ‚aÅ›nie z powodu tego, Å¼e `0` jest wartoÅ›ciÄ… _falsy_, JavaScript przetworzy je i natychmiastowo zwrÃ³ci. Kilka przykÅ‚adÃ³w wykorzystania `&&`:

```ts
0 && true; // 0
true && 0; // 0
false && true; // false
true && ''; // ''
```

Dlaczego wiÄ™c takie `false` albo `undefined` nie jest renderowane przez JSX w DOM? PoniewaÅ¼ `0`, w przeciwieÅ„stwie do tych wartoÅ›ci, jest w 100% poprawnym React Node, dlatego moÅ¼emy zrobiÄ‡ `<p>iloÅ›Ä‡ sztuk: {quantity}</p>` i dostaniemy poprawnÄ… wiadomoÅ›Ä‡ z iloÅ›ciÄ… produktÃ³w.

Bardzo czÄ™stym przykÅ‚adem jest rÃ³wnieÅ¼Â sprawdzanie dÅ‚ugoÅ›ci tablicy i na bazie tego renderowane komponentu:

<Highlight variant="error" title="Å¹le  âŒ">

```tsx
items.length && <ItemsList items={items} />;
```

</Highlight>

Jak to naprawiÄ‡? Mam kilka asÃ³w w rÄ™kawie:

<Highlight variant="success" title="Dobrze  âœ…">

```tsx
items.length > 0 && <ItemsList items={items} />;

// lub

!!items.length && <ItemsList items={items} />;

// lub

Boolean(items.length) && <ItemsList items={items} />;

// lub

items.length ? <ItemsList items={items} /> : null;
```

</Highlight>

## PierwszeÅ„stwo operatorÃ³w

Budujemy dashboard dla naszego serwera Discord, w ktÃ³rym administratorzy i moderatorzy bÄ™dÄ… mogli zmieniaÄ‡ ustawienia serwera. KaÅ¼dy uÅ¼ytkownik w naszej aplikacji bÄ™dzie miaÅ‚Â specjalne pole **roli**, na bazie ktÃ³rej bÄ™dziemy chcieli renderowaÄ‡ komponent ustawieÅ„ serwera:

```tsx
// prettier-ignore
user.role === 'admin' || user.role === 'moderator' && <ServerSettings />;
```

> Olaf, szukam i szukam ten puÅ‚apki, ale w tym kodzie nie ma nic nadzwyczajnego!

Wszystko rozchodzi siÄ™Â o tzw. [pierwszeÅ„stwo operatorÃ³w](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Operator_Precedence). Logiczny operator AND ('&&') ma pierwszeÅ„stwo nad OR (`||`), dlatego pod spodem nasz kodem bÄ™dzie wyglÄ…daÅ‚ w ten sposÃ³b:

<Highlight variant="error" title="Å¹le  âŒ">

```tsx
user.role === 'admin' || (user.role === 'moderator' && <ServerSettings />);
```

</Highlight>

Jak juÅ¼ moÅ¼esz siÄ™Â domyÅ›liÄ‡, ten kod skoÅ„czyÅ‚by siÄ™ istnÄ…Â katastrofÄ…! Gdy nasz uÅ¼ytkownik bÄ™dzie miaÅ‚ rolÄ™Â administratora, wyraÅ¼enie `user.role === 'admin'` zamieni siÄ™Â na `true` a to przy operatorze OR (`||`) zostanie zwrÃ³cone do JSX...

SposÃ³b na poprawienie tego, to odpowiednie dostosowanie nawiasÃ³w:

<Highlight variant="success" title="Dobrze  âœ…">

```tsx
(user.role === 'admin' || user.role === 'moderator') && <ServerSettings />;
```

</Highlight>

## CzytelnoÅ›Ä‡

Ternaries i czytelnoÅ›Ä‡ to czÄ™sto toksyczny zwiÄ…zek âŒ To jedna z najczÄ™stszych i najbardziej przebiegÅ‚ych puÅ‚apek!

WrÃ³Ä‡my do dashboardu, dla kaÅ¼dej roli uÅ¼ytkownika chcemy wyÅ›wietlaÄ‡ osobny dashboard:

<Highlight variant="error" title="Å¹le  âŒ">

```tsx
const Dashboard = ({ user }) => (
  <div>
    <Header />
    {user.role === 'admin' ? (
      <AdminUserDashBoard />
    ) : user.role === 'moderator' ? (
      <ModeratorUserDashBoard />
    ) : user.role === 'normal' ? (
      <NormalUserDashBoard />
    ) : (
      <span>Twoja rola nie jest obecnie wspierana</span>
    )}
    <Footer />
  </div>
);
```

</Highlight>

AÅ‚Ä‡! Z kaÅ¼dÄ…Â dodanÄ… rolÄ… ten kod bÄ™dzie wyglÄ…daÅ‚ tylko gorzej. SprÃ³bujmy podejÅ›cia z klasycznymi ifami:

<Highlight variant="warning" title="If, if i if ğŸ¤”">

```tsx
type UserRole = 'admin' | 'moderator' | 'normal';

const renderUserDashboard = (role: UserRole) => {
  if (role === 'admin') {
    return <AdminUserDashBoard />;
  }
  if (role === 'moderator') {
    return <ModeratorUserDashBoard />;
  }
  if (role === 'normal') {
    return <NormalUserDashBoard />;
  }

  return <span>Twoja rola nie jest obecnie wspierana</span>;
};

const Dashboard = ({ user }) => (
  <div>
    <Header />
    {renderUserDashboard()}
    <Footer />
  </div>
);
```

</Highlight>

Lepiej lepiej, ale nadal te ify mnie nie przekonujÄ…, co powiesz na switcha?

<Highlight variant="warning" title="A moÅ¼e tak? ğŸ¤”">

```tsx
type UserRole = 'admin' | 'moderator' | 'normal';

const renderUserDashboard = (role: UserRole) => {
  switch (role) {
    case 'admin':
      return <AdminUserDashBoard />;
    case 'moderator':
      <ModeratorUserDashBoard />;
    case 'normal':
      <NormalUserDashBoard />;
    default:
      <span>Twoja rola nie jest obecnie wspierana</span>;
  }
};

const Dashboard = ({ user }) => (
  <div>
    <Header />
    {renderUserDashboard()}
    <Footer />
  </div>
);
```

</Highlight>

Hmm, sam nie wiem, czy mamy coÅ› jeszcze w zanadrzu?

### React-If

JakiÅ› czas temu natrafiÅ‚em na doÅ›Ä‡ ciekawÄ…Â bilbiotekÄ™, [react-if](https://github.com/romac/react-if) zamiast korzystaÄ‡ z ternatires, uÅ¼ywa zwykÅ‚ych komponentÃ³w:

```tsx
const Dashboard = ({ user }) => (
  <div>
    <Header />
    <If condition={user.role === 'admin'}>
      <Then>
        <AdminUserDashBoard />
      </Then>
    </If>
    <If condition={user.role === 'moderator'}>
      <Then>
        <ModeratorUserDashBoard />
      </Then>
    </If>
    <If condition={user.role === 'normal'}>
      <Then>
        <NormalUserDashBoard />
      </Then>
    </If>
    <Unless condition={['admin', 'moderator', 'normal'].includes(user.role)}>
      <span>Twoja rola nie jest obecnie wspierana</span>
    </Unless>
    <Footer />
  </div>
);
```

Mamy tutaj do dyspozycji takie komponetny jak `<If/>`, `<Else/>`, `<When/>`, `<Unless/>`, a nawet odpowiednik klasycznego `<Switch/>`:

<Highlight variant="warning" title="A moÅ¼e tak? ğŸ¤”">

```tsx
const Dashboard = ({ user }) => (
  <div>
    <Header />
    <Switch>
      <Case condition={user.role === 'admin'}>
        <AdminUserDashBoard />
      </Case>
      <Case condition={user.role === 'moderator'}>
        <ModeratorUserDashBoard />
      </Case>
      <Case condition={user.role === 'normal'}>
        <NormalUserDashBoard />
      </Case>
      <Default>
        <span>Twoja rola nie jest obecnie wspierana</span>
      </Default>
    </Switch>
    <Footer />
  </div>
);
```

</Highlight>

Frontend Developerzy, ktÃ³rzy przyzwyczajeni sÄ… do pisania we Vue, czy Angularze znajÄ… podobne patterny, ale mi jakoÅ› ciÄ™Å¼ko siÄ™ do nich przyzwyczaiÄ‡, chociaÅ¼ muszÄ™Â przyznaÄ‡, Å¼e to o wiele bardziej czytelne :)

### Pattern Matching

A co powiesz na [Pattern Matching](https://dev.to/gvergnaud/bringing-pattern-matching-to-typescript-introducing-ts-pattern-v3-0-o1k)? Halo Olaf, ale przecieÅ¼ [ECMA proposal](https://github.com/tc39/proposal-pattern-matching) dla tej konstrukcji jest dopiero w pierwszym stage'u! Uwaga, mam godnego zastÄ™pce, `ts-pattern` to bilbioteka do pseudo Pattern Matchingu zbudowana z myÅ›lÄ… o TypeScripcie ğŸ’™

<Highlight variant="success" title="Czytelniej  âœ…">

```tsx
type UserRole = 'admin' | 'moderator' | 'normal';

const Dashboard = ({ user }) => (
  <div>
    <Header />
    {match<UserRole>(user.role)
      .with('admin', () => <AdminUserDashBoard />)
      .with('moderator', () => <ModeratorUserDashBoard />)
      .with('normal', () => <NormalUserDashBoard />)
      .otherwise(() => (
        <span>Twoja rola nie jest obecnie wspierana</span>
      ))}
    <Footer />
  </div>
);
```

</Highlight>

WyglÄ…da to naprawdÄ™Â **Å›wietnie** i jest _type-safe_! TakÄ… konstrukcjÄ™Â moÅ¼emy rÃ³wnieÅ¼Â wynieÅ›Ä‡ do funkcji `renderUserDashboard` :) Czego chcieÄ‡ wiÄ™cej?

Minusem takiego rozwiÄ…zania jest na pewno koniecznoÅ›Ä‡Â instalowania dodatkowej biliboteki, no cÃ³Å¼, coÅ›Â za coÅ›.

## Podsumowanie

_It's a trap!_ Tak moÅ¼na podsumowaÄ‡ konstrukcje warunkowe w React i JSX. UwaÅ¼ajcie na siebie i nie dajcie siÄ™Â zÅ‚apaÄ‡!

Do usÅ‚yszenia!
