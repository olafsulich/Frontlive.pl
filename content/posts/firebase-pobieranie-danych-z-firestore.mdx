---
title: 'Firebase - pobieranie danych z Firestore'
category: 'Firebase'
publishedAt: '26-03-2020'
isPublished: true
popular: false
excerpt: 'Wnie swoj wiedz na temat Firebase na wy偶szy poziom, poznaj Firestore - baz danych Firebase.'
---

## Stw贸rzmy wasnbaz danych!

W poprzednim wpisie nauczye si, jak doda autoryzacj u偶ytkownik贸w do swojej firebasowej aplikacji. Dzi poznamy [Cloud Firestore](https://firebase.google.com/docs/firestore).

## Co powiniene wiedzie?

呕eby wycign z tego artykuu 100%, powiniene swobodnie porusza si po Reactcie.

- Mie w maym palcu [HTML & CSS](https://tutorials.comandeer.pl/html5-blog.html).
- By obeznanym ze standardami [ES6+](https://www.youtube.com/watch?v=eA2YRceiDwk).
- Rozumie [Reactowe Hooki](https://reactjs.org/docs/hooks-intro.html)
- Posiada podstawow wiedz ze [Styled Components](https://styled-components.com/)

> Jeli te zagadnienia s Ci obce, nie martw si! Firebase mo偶esz r贸wnie偶 wykorzysta bez znajomoci Reacta.

## Konfiguracja Firebase

Utw贸rzmy plik **firebase.js** a w nim dodajmy nasz objekt konfiguracyjny i zainicjujmy aplikacj. Przypisujemy do consta firestore, metod obiektu firebase, **firestore()**

Tw贸j plik powinien wyglda mniej wicej tak:

```js
import firebase from 'firebase/app';
import 'firebase/firestore';

const firebaseConfig = {
  apiKey: 'AIzaSyDctz47bkEEwdiOMPVnIWWqTTzdtpveAzw',
  authDomain: 'frontlive-1.firebaseapp.com',
  databaseURL: 'https://frontlive-1.firebaseio.com',
  projectId: 'frontlive-1',
  storageBucket: 'frontlive-1.appspot.com',
  messagingSenderId: '1008294462858',
  appId: '1:1008294462858:web:a888d2891e908d183e7473',
};
// Inicjujemy aplikacj
firebase.initializeApp(firebaseConfig);

export const firestore = firebase.firestore();
```

> Jeli nie wiesz co tutaj si stao, odsyam Ci do pierwszego wpisu gdzie wyjaniem konfiguracj bardziej szczeg贸owo.

## Typy danych

呕eby rozpocz przygod z [Firestore](https://firebase.google.com/docs/firestore), musimy najpierw dowiedzie si, co tak naprawdmo偶emy w niej trzyma.

- Array
- String
- Boolean
- Date and time
- Map

To tylko kilka typ贸w danych, jeli chcesz pozna je wszystkie, kliknij [tutaj](https://firebase.google.com/docs/firestore/manage-data/data-types)

## Tworzymy pierwszkolekcj

Przejd藕 teraz do zakadki Database i utw贸rz now baz danych.
Po wybraniu odpowiedniej strefy czasowej powinienezobaczy pust baz danych:

![](../images/Firestore.png)

Utw贸rzmy teraz now kolekcj o nazwi **tw贸rcy**, indetyfikator pozostawmy jako automatyczny i przechodzimy dalej.

Jako naszego pierwszego tw贸rce we藕my [Dana Abramova](https://mobile.twitter.com/dan_abramov).

Stw贸rzmy odpowiednie **pola**, wszystkie bdtypu `string`

- name
- photo
- website

Jako **wartoci**, podamy odpowiednie dane:

- name: Dan Abramov
- photo: https://bit.ly/39hShFn
- website: https://overreacted.io/

Zapisujemy i gotowe!

![](../images/Firestore-tw贸rcy.png)

Ten dziwny cig znak贸w to **id** naszego dokumentu, w moim przypadku jest to `zk5DTr1BchPfaeUUokOd`

## Komponenty widoku

Tworzymy podstawowy szkielet aplikacji, skadajcy si z dw贸ch komponent贸w, **App** i **CreatorCard**:

```js
import React from 'react';
import styled from 'styled-components';

const StyledWrapper = styled.section`
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  margin-top: 5rem;
`;

const StyledHeading = styled.h1`
  font-size: 3rem;
  font-weight: bold;
  font-family: 'Montserrat';
  text-transform: uppercase;
`;

const App = () => {
  return (
    <StyledWrapper>
      <StyledHeading>Tw贸rcy</StyledHeading>
    </StyledWrapper>
  );
};

export default App;
```

---

```js
import React from 'react';
import styled from 'styled-components';

const StyledWrapper = styled.section`
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  margin-top: 5rem;
`;

const StyledCard = styled.div`
  width: 30rem;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  border: 2px solid #f2f5f7;
`;

const StyledCreatorInfo = styled.div`
  padding: 2rem;
  height: 100%;
  width: 50%;
  display: flex;
  align-items: flex-start;
  justify-content: space-around;
  flex-direction: column;
`;

const StyledCreatorName = styled.span`
  font-size: 1rem;
  margin-bottom: 1rem;
`;

const StyledCreatorWebsite = styled.a`
  font-size: 1rem;
  color: inherit;
`;

const StyledCreatorImage = styled.img`
  height: 100%;
  width: 30%;
`;

const CreatorCard = () => {
  return (
    <StyledWrapper>
      <StyledCard>
        <StyledCreatorImage src="https://bit.ly/39hShFn" alt="Dan Abramov" />
        <StyledCreatorInfo>
          <StyledCreatorName>Dan Abramov</StyledCreatorName>
          <StyledCreatorWebsite href="https://overreacted.io/">
            https://overreacted.io/
          </StyledCreatorWebsite>
        </StyledCreatorInfo>
      </StyledCard>
    </StyledWrapper>
  );
};

export default CreatorCard;
```

## Pobieranie danych

Komponenty gotowe to teraz czas na najwa偶niejsze - pobieranie kolekcji, kt贸r przed chwil stworzylimy.

Jako nasz lokalny state, do kt贸rego bd przekazywane dane wykorzystamy hooka [useState](https://pl.reactjs.org/docs/hooks-state.html), a jego pocztkow wartoci bdzie pustatablica.

```js
const [creators, setCreators] = useState([]);
```

Nastpnym krokiem bdzie odwoanie si do kolekcji `tw贸rcy`.

```js
const creatorsCollections = firestore.collection('tw贸rcy');
```

Nastpnie piszemy prost funkcj kt贸ra zwr贸ci nam objekt z **id** dokumentu oraz **resztdanych**.

Jako argument przekazujemy dokument, wykorzystujemy r贸wnie偶 [spread operator](https://developer.mozilla.org/pl/docs/Web/JavaScript/Referencje/Operatory/Spread_operator), 偶eby "rozsmarowa" nasze dane.

```js
const documentsCollection = (doc) => {
  return { id: doc.id, ...doc.data() };
};
```

> **data()** zwraca wszystkie pola dokumentu.

Na koniec tworzymy hooka [useEffect](https://pl.reactjs.org/docs/hooks-effect.html), w kt贸rym najwicej sidzieje.

Korzystamy tutaj z `subskrybcji`, wicej o **subskrybcjach** w useEffect mo偶esz przeczyta [tutaj](https://typeofweb.com/react-hooks-useeffect-efekty-uboczne-w-komponencie/)

Nasza kolekcja **creatorsCollection** daje nam dostp do metody `onSnaphot()`, pozwala ona na cige nasuchiwanie zmian. Dziki temu, zmiany, kt贸re wprowadzimy w bazie danej, bd **natychmiastowo** uaktualniane!

Wewntrz tej metody, podajemy **snapshota** i to go bdziemy wykorzystywa we wczeniej przygotowanej funkcji `documentsCollection`.

U偶ywajc **snapshota** mamy dostp do metody `.docs`, kt贸ra zwraca nam wszystkie dokumenty danej kolekcji. Teraz mo偶emy u偶y [map](https://developer.mozilla.org/pl/docs/Web/JavaScript/Referencje/Obiekty/Array/map) i poda do niej funkcje `documentsCollection`.

Wrzucamy teraz zmapowane dane z kolekcji do `setCreators` i gotowe!

```js
useEffect(() => {
  const subscribe = creatorsReference.onSnapshot((snapshot) => {
    const dataFromCollection = snapshot.docs.map(documentsCollection);
    setCreators(dataFromCollection);
  });
  return () => subscribe;
}, []);
```

> Halo halo, zrobiem wszystko tak jak podae a wyskauje mi **ERROR**.

Jeli wyskoczy Ci **ERROR**, a w nim informacja o braku uprawnie to bardzo dobrze - przejd藕my w takim razie do tematu regu w firestore.

## Reguy firestore

Jeli przy konfiguracji wybrae aby Twoja baza danych bya w trybie `produkcyjnym`, to Firestore bdzie na Ciebie bardzo zy, dop贸ki nie zadeklarujesz **Regu bezpieczestwa**

Temat regu zasuguje na przynajmniej osobny wpis, wic nie bd teraz omawia gbiej tego tematu.

Aby wszystko zaczo dziaa zezw贸l wszystkim dokumentom na **odczyt** i **zapis**

```
 rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write;
    }
  }
}
```

## Wywietlenie danych

Mamy ju偶 wszystkie potrzebne dane do wywietlenia karty z tw贸rc, bierzemy sido wywietlenia caoci.

Do komponentu `CreatorCard` podajemy zdestrukturyzowane propsy `name, image, website`.

Za pomocmetody [map](https://developer.mozilla.org/pl/docs/Web/JavaScript/Referencje/Obiekty/Array/map) zwracamy `CreatorCard` z odpowiednimi propsami.

Jako [key](https://pl.reactjs.org/docs/lists-and-keys.html) podajmy `id` dokumentu.

```js
<StyledWrapper>
  <StyledHeading>Tw贸rcy</StyledHeading>
  {creators.map(({ id, name, photo, website }) => (
     <CreatorCard key={id} name={name} photo={photo} website={website} />;
  ))}
</StyledWrapper>
```

## Podsumowanie

Dziki za wytrwanie do koca!

Mam nadziej, 偶e po dzisieszym wpisie bdziesz umia stworzy podstawow baz danych w `Firestore` i zacign z niej dane.

Zachcam do dodania swoich ulubionych tw贸rc贸w, ja ju偶 to zrobiem, rezultaty mo偶esz zobaczy poni偶ej 

Cay kod znajdziesz [tutaj](https://codesandbox.io/s/friendly-mayer-5j8qm), pamitaj tylko o podmienieniu danych konfiguracyjnych w pliku `firebase.js`.

Do usyszenia!
