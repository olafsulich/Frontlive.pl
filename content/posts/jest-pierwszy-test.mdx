---
title: 'Jest - pierwszy test'
category: 'Testowanie'
publishedAt: '15-02-2021'
isPublished: true
popular: false
image: '/images/jest-pierwszy-test/jest-pierwszy-test.png'
excerpt: 'Poznaj najpopularnieszy framework do testowania kodu JavaScript!'
---

W poprzednim wpisie poznalimy podstawowe zao偶enia kryjce siza testowaniem. Dzi przesza pora na prac z prawdziwymi narzdziami. Przedstawiam Ci <Sparkles>Jest</Sparkles> - najpopularnieszy framework do testowania kodu JS!

Cay dzisiejszy kod napisany jest w **TypeScripcie**, taki may eksperyment :) Jeli nie znasz TS, to nic straconego! Mo偶esz pomin cz zwizanz typami lub zajrze do mojej [serii artyku贸w](https://frontlive.pl/kategorie/typescript) na temat tego jzyka.

## Konfiguracja

Jeli chcesz pomin konfiguracj, mo偶esz skorzysta z przygotowanego [startera na GitHubie](https://github.com/olafsulich/jest-workshop/tree/01-pierwszy-test/start).

Zanim zaczniemy pisa faktyczne testy, potrzebujemy zainstalowa kilka niezbdnych paczek:

```bash
npm install jest ts-jest typescript @types/jest --save-dev
```

wietnie, 偶eby korzysta z wszystkich dobrodziejstw Jest, musimy stworzy plik konfiguracyjny `jest.config.js` w katalogu g贸wnym.

```js
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'node',
};
```

Na ten moment ustawiamy tylko tzw. _preset_ i rodowisko dla naszych test贸w.

## Pierwszy test

O co tak naprawd chodzi w testach? Najog贸lniej m贸wic, bdziemy w nich chcieli **por贸wnywa** oczekiwanprzez nas warto, do takiej, jaka faktycznie jest.

Zacznijmy od prostej funkcji, kt贸ra bdzie mno偶ya podan liczb przez 2, a nastpnie j zwracaa:

```ts
function multiplyBy2(value: number) {
  return value * 2;
}
```

Jeli chcielibymy opisa oczekiwane dziaanie funkcji, to powiedzielibymy, 偶e po podaniu argumentu `2`, z naszej funkcji zawsze otrzymamy `4`.

Prze贸偶my teraz to stwierdzenie na kod i stw贸rzmy funkcj, kt贸ra bdzie sprawdzaa dziaanie `multiplyBy2`:

```ts
function expect<T>(actual: T) {
  return {
    toBe(expected: T) {
      if (actual !== expected) {
        throw new Error(`${actual} is not equal to ${expected}`);
      }
    },
  };
}
```

Przetestujmy teraz funkcj`multiplyBy2` za pomoc`expect()`:

```ts
expect<number>(multiplyBy2(2)).toBe(5);
```

Bang! Nasz test nie przeszed i dostalimy bd _4 is not equal to 5_. wietnie, nasza funkcja zadziaaa tak, jakbymy tego oczekiwali.

## Podstawy Jest

Dziki Jest, nie musimy tworzyfunkcji `expect`, ten framework robi to za nas! Dodatkowo korzystalimy w niej z tzw. _matchera_ - `toBe`. Jest dostarcza nam szereg podobnych _matcher贸w_, do kt贸rych za chwilprzejdziemy.

Przeniemy siteraz na **mecz koszyk贸wki**. Jest pomo偶e nam przetestowa kilka, kluczowych dla rozgrywek, funkcji. Zacznijmy od czego prostego, zwr贸my zawodnik贸w obu dru偶yn:

```ts
export type Player = {
  readonly name: string;
  readonly points: number;
};

export function getAllPlayers(team1: Player[], team2: Player[]) {
  return [...team1, ...team2];
}
```

Nasza funkcja gotowa, czas j przetestowa! Stw贸rzmy nowy katalog `tests`, a w nim plik `match.spec.ts`. Rozszerzenie `.spec` jest tutaj kluczone, dziki niemu Jest wie, 偶e jest to **plik z testami**. Mo偶esz sir贸wnie偶 spotka z rozszerzeniem `.test`, dziaa to na tej samej zasadzie.

Jest oferuj nam specjaln funkcj`it()`, w kt贸rej dziejesicaa magia. W pierwszej kolejnoci podajemy **opis testu**. Drugim parametrem jest _callback_, w kt贸rym bdziemy wywoywa funkcji por贸wnywa oczekiwan i faktyczn warto.

```ts
it('opis testu', () => {
  // test
});
```

Zaimportujmy teraz waciw funkcji potrzebne dane obu dru偶yn. Jak widzisz, wywoujemy `getAllPlayers` w rodku `it()`, nastpnie korzystamy ze znanej Ci ju偶 funkcji `expect()`.

```ts
import { getAllPlayers } from '../src/match';
import { team1, team2, allPlayers } from '../data/teams';

it('returns all players in a match', () => {
  const result = getAllPlayers(team1, team2);
  expect(result).toEqual(allPlayers);
});
```

Tym razem korzystamy z _matchera_ `.toEqual()`, su偶y on, w przeciwiestwie do `.toBe`, do por贸wnywania nieprymitywnych wartoci.

Nadesza ta wiekopomna chwila, **odpalmy nasz test!** Dodajmy do `package.json` odpowiedni skrypt:

```json
"scripts": {
    "test": "jest --watch"
  },
```

Uff, nasz test przeszed, jestemy bezpieczni!

> Dziki fladze --watch, Jest bdzie nasuchiwa na zmiany w plikach z testami

## Testy w praktyce

W ramach praktyki napiszmy jeszcze kilka prostych funkcji. Po zakoczonym meczu chcemy wyoni najlepszego gracza i zebra cznliczb punkt贸w.

```ts
export function getGreatestPlayer(players: Player[]) {
  const playerWithHighestScore = players.reduce((prev, curr) => {
    return prev.points > curr.points ? prev : curr;
  });
  return playerWithHighestScore;
}

export function getTotalScore(players: Player[]) {
  const totalScore = players.reduce((prev, curr) => {
    return prev + curr.points;
  }, 0);
  return totalScore;
}
```

Przysza pora na testy. Jak widzisz, w naszych testach, korzystamy z wczeniej przygotowanej i otestowanej funkcji `getAllPlayers`:

```ts
it('returns player with the most points', () => {
  const players = getAllPlayers(team1, team2);
  const greatestPlayer = getGreatestPlayer(players);
  expect(greatestPlayer.name).toBe('Blake Griffin');
});

it('returns a total score', () => {
  const players = getAllPlayers(team1, team2);
  const totalScore = getTotalScore(players);
  expect(totalScore).toBe(163);
});
```

Caa organizacja meczu zakoczya sisukcesem, a to wszystko dziki naszym testom! Dodatkowo nasza ulubiona dru偶yna wygraa i chcemy to uczci! Udajemy sido lokalnego baru, by kupi piwo.

Waciciel baru napisa specjalnfunkcj, dziki kt贸rej tylko osoby penoletnie mogkupi alkohol:

```ts
export type Person = {
  readonly name: string;
  readonly age: number;
};

export function getBeer(person: Person) {
  if (person.age < 18) {
    throw new Error("You're too young to buy a beer");
  }
  return '';
}
```

W tym przypadku musimy sprawdzi, czy osoba jest penoletnia, jeli tak, to zwracamy jej piwo, w przeciwnym wypadku wywietlamy odpowiedni komunikat z bdem:

```ts
import { getBeer, Person } from '../src/beer';

describe('getBeer', () => {
  it('returns a beer if the person is at least 18 years old', () => {
    const person: Person = {
      name: 'Olaf',
      age: 20,
    };

    expect(person.age).toBeGreaterThanOrEqual(18);
    expect(getBeer(person)).toBe('');
  });
});
```

Skorzystajmy tutaj z dostpnej w Jest funkcji `describe`. Dziki niej mo偶emy _zgrupowa_ kilka test贸w i otrzyma przejrzystsze informacje w konsoli. Jak widzisz, nasze testy wietnie opisuj dziaanie funkcji, su偶 nam za swoist dokumentacj, kt贸r czytamy jak normalne zdania.

Wr贸my do testu, sprawdzamy tutaj, czy osoba ma przynajmniej 18 lat, wykorzystujemy do tego kolejny _matcher_ `.toBeGreaterThanOrEqual`. Jeli wynik wyjdzie pozytywny, to wywoujemy nasz funkcj z wczeniej przygotowanym obiektem i otrzymujemy piwo, wszystko poszo po naszej myli.

To by nasz _happy path_, teraz musimy obsu偶y przypadek, w kt贸rym osoba ma mniej ni偶 18 lat.

```ts
import { getBeer, Person } from '../src/beer';

describe('getBeer', () => {
  it('returns a beer if the person is at least 18 years old', () => {
    const person: Person = {
      name: 'Olaf',
      age: 20,
    };

    expect(person.age).toBeGreaterThanOrEqual(18);
    expect(getBeer(person)).toBe('');
  });

  it('throws an error when the person is under 18 years old', () => {
    const person: Person = {
      name: 'Maciek',
      age: 16,
    };

    expect(person.age).toBeLessThan(18);
    expect(() => getBeer(person)).toThrow("You're too young to buy a beer");
  });
});
```

Tutaj ponownie korzystamy z `it()` i kolejnego _matchera_ `.toBeLessThan()`. Nastpnie przekazujemy przygotowany obiekt i sprawdzamy, czy nasza funkcja rzuci bdem. Zwr贸 uwag,偶e w przypadku _matchera_ `.toTrow`, `.getBeer` musimy jeszcze _owrapowa_ w dodatkow funkcj, w innym przypadku nasza asercja nie zadziaa.

## Asynchroniczno

Wr贸my do pocztku, za贸偶my, 偶e nasza funkcja `multiplyBy2` byaby asynchroniczna:

```ts
import { multiplyBy2 } from './multiplyBy2';

export function multiplyBy2Async(value: number) {
  return Promise.resolve(multiplyBy2(value));
}
```

Przetestowanie tej funkcji to buka z masem, mo偶emy skorzysta np. ze znanej Ci skadni async await:

```ts
import { multiplyBy2Async } from '../src/multiplyBy2Async';

it('multiplies given number by 2 asynchronously', async () => {
  const result = await multiplyBy2Async(2);
  const expected = 4;
  expect(result).toBe(expected);
});
```

Do asynchronicznego kodu jeszcze wr贸cimy w nastpnym wpisie, ale warto, 偶eby wiedzia/a o takiej opcji :)

## Podsumowanie

To wszystko na dzi, cay kod znajdziesz w [repozytorium na GitHubie](https://github.com/olafsulich/jest-workshop).

Do usyszenia!
