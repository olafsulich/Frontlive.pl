---
title: 'Dlaczego z-index nie dziaÅ‚a?'
category: 'CSS'
publishedAt: '14-11-2022'
isPublished: true
popular: false
image: '/images/css-stacking-context/thumbnail.png'
excerpt: 'Niech pierwszy rzuci kamieniem ten, ktÃ³ry nigdy nie miaÅ‚ problemÃ³w z z-index w CSS. Poprawne uÅ‚oÅ¼enie elementÃ³w nie raz przyprawiÅ‚o mnie o bÃ³l gÅ‚owy. Masakra. Jak sobie z tym radziÄ‡?'
---

Niech pierwszy rzuci kamieniem ten, ktÃ³ry nigdy nie miaÅ‚ problemÃ³w z `z-index` w CSS. Poprawne uÅ‚oÅ¼enie elementÃ³w nie raz przyprawiÅ‚o mnie o bÃ³l gÅ‚owy. **Masakra!** Nic w tym dziwnego, ten mechanizm to jeden z "kruczkÃ³w" CSS, ktÃ³re potrafiÄ… byÄ‡ naprawdÄ™ problematyczne.

Tworzysz prosty sklep e-commerce. ChciaÅ‚byÅ›, Å¼eby nawigacja byÅ‚a pod, a koszyk nad innymi elementami. ProÅ›cizna? DopÃ³ki wszystko bÄ™dzie szÅ‚o po Twojej myÅ›li. Zanim zaczniesz wyrywaÄ‡ wÅ‚osy z gÅ‚owy, z powodu niedziaÅ‚ajÄ…cego `z-index: 999999;`, zrozum jak ten mechanizm naprawdÄ™ dziaÅ‚a.

<Image src="/images/css-stacking-context/ecommerce-broken.png" alt="" />

## Podstawy

Wszyscy wiemy jak ustawiÄ‡ dwa kwadraty tak, aby jeden nachodziÅ‚ na drugi. Wrzucamy dwa _boxy_ do wspÃ³lnego rodzica. DominujÄ…cemy kwadratowi nadajemy wiÄ™kszÄ… wartoÅ›Ä‡ `z-index`:

```html
<style>
  .wrapper {
    position: relative;
  }

  .box-red {
    position: absolute;
    z-index: 2;
  }

  .box-pink {
    position: absolute;
    z-index: 1;
  }
</style>

<div class="wrapper">
  <div class="box-red"></div>
  <div class="box-pink"></div>
</div>
```

Åšmiga, moÅ¼na siÄ™ rozejÅ›Ä‡. RozwiÄ…zaliÅ›my problem upierdliwych `z-index`!

<Image src="/images/css-stacking-context/one.png" alt="" />

Hola hola, to jeszcze nie wszystko. WeÅºmy teraz na tapet sytuacjÄ™, w ktÃ³rej nasz _dominujÄ…cy_ kwadrat, opakowujemy w dodatkowy _wrapper_:

<Image src="/images/css-stacking-context/two.png" alt="" />

Wszystko poszÅ‚o siÄ™ je... WrÃ³Ä‡my do kodu i przeanalizujmy co mogÅ‚o pÃ³jÅ›Ä‡ nie tak.

```html
<div class="wrapper">
  <div class="box-dashed">
    <div class="box-red"></div>
  </div>
  <div class="box-pink"></div>
</div>
```

Na pierwszy ogieÅ„ idzie HTML - od teraz nasz _dominujÄ…cy_ kwadrat jest opleciony w dodatkowego rodzica. Z perspektywy CSS, nasz rodzic co prawda ma mniejszy `z-index` od kwadratu `box-pink`, ale _dominujÄ…cy_ `box-red` powinien to przebiÄ‡.

**Gdzie wiÄ™c leÅ¼y problem?** ğŸ¤”

```css
.wrapper {
  position: relative;
}

.box-dashed {
  position: relative;
  z-index: 1;
}

.box-red {
  position: absolute;
  z-index: 3;
}

.box-pink {
  position: absolute;
  z-index: 2;
}
```

**PodpowiedÅº:** ustawienie `z-index` na `999999999` nie pomoÅ¼e ğŸ™ˆ

## Stacking Context

WinowajcÄ… tego caÅ‚ego zamieszania jest mistyczny mechanizm w CSS zwany _stacking context_.

DomyÅ›lnie, czysty dokument HTML tworzy _context_ wzglÄ™dem ktÃ³rego ukÅ‚ada elementy. O _stacking context_ moÅ¼emy myÅ›leÄ‡ jak o **_warstwie_**, ktÃ³ra pozwala nam ukÅ‚adaÄ‡ elemeny wzglÄ™dem siebie.

Poza domyÅ›lÄ… warstwÄ…, nadajÄ…c elementom konkretne wÅ‚aÅ›ciwoÅ›ci, tworzymy nowy _stacking context_. Dla przykÅ‚adu - poÅ‚Ä…czenie `position: relative` / `position: absolute` + `z-index` tworzy nowÄ… _warstwÄ™_.

<Image src="/images/css-stacking-context/sc-1.png" alt="" />

PorÃ³wnywaÄ‡ ze sobÄ… elementy moÅ¼emy **tylko** wzglÄ™dem nadrzÄ™dnej _warstwy_. **WÅ‚aÅ›ciwoÅ›Ä‡ `z-index` nie jest wÅ‚aÅ›ciwoÅ›ciÄ… globalnÄ…!**

TworzÄ…c dwa elementy, gdzie kaÅ¼dy element posiada `position: relative` + odpowiedni `z-index`, tworzymy dwie warstwy. Obie _warstwy_ posiadajÄ… w sobie dodatkowo po trzy elementy. KaÅ¼dy z zagnieÅ¼dÅ¼onych elementÃ³w posiada wÅ‚asny `z-index` + `position: absolute`.

WizualizujÄ…c sobie ten mechanizm, moÅ¼emy myÅ›leÄ‡ o zagnieÅ¼dÅ¼onych _warstwach_, jak o wersjach nadrzÄ™dnego _stacking context_. Wersja `1.5` jest wiÄ™ksza od `1.3`, ale nie ma szans na przebicie `2.4`. Nie waÅ¼ne jak duÅ¼y `z-index` damy, mÃ³gÅ‚by on nawet wynosiÄ‡ `999999`, a i tak nie przebije wersji `2.0`:

<Image src="/images/css-stacking-context/sc-3.png" alt="" />

SprÃ³bujmy naprawiÄ‡ nasz poprzedni przykÅ‚ad. ZaleÅ¼y nam na tym, Å¼eby kwadrat z klasÄ… `box-red` pojawiÅ‚ siÄ™ nad `box-pink`. OsiÄ…gamy to dziÄ™ki pozbyciu siÄ™ _warstwy_, ktÃ³rÄ… tworzyÅ‚ `box-dashed` za pomocÄ… dwÃ³ch wczeÅ›niej wspomnianych wÅ‚aÅ›ciwoÅ›ci - `position: relative` + `z-index`.

Chcemy nadal pozycjonowaÄ‡ odpowiednio elementy, wiÄ™c zostawiamy `position: relative`. Usuwamy za to `z-index`, ktÃ³ry w tej kombinacji jest niezbÄ™dny do stworzenia _warstwy_.

```css
/* Stacking Context: âŒ */
.wrapper {
  position: relative;
}

/* Stacking Context: âŒ */
.box-dashed {
  position: relative;
  /* z-index: 1; */
}

/* Stacking Context: âœ… */
.box-red {
  position: absolute;
  z-index: 3;
}

/* Stacking Context: âœ… */
.box-pink {
  position: absolute;
  z-index: 2;
}
```

UsuwajÄ…c _stacking context_ `box-dashed` zostajemy z trzema _warstwami_:

- Dokument HTML
  - `box-red`
  - `box-pink`

ZagnieÅ¼dÅ¼one w domyÅ›lym _stacking context_ dokumentu HTML, _warstwy_ `box-red` oraz `box-pink` pozostajÄ… **na tym samym poziomie** i mogÄ… byÄ‡ porÃ³wnane ze sobÄ….

<Image src="/images/css-stacking-context/sc-4.png" alt="" />

## Co tworzy Stacking Context?

_Warstwy_ moÅ¼emy tworzyÄ‡ na wiele rÃ³Å¼nych sposÃ³bÃ³w. PowiedzieliÅ›my sobie, Å¼e poÅ‚Ä…cznenie `position: relative` / `position: abosolute` + `z-index` tworzy nowy _stacking context_, czy jest coÅ› jeszcze?

Z popularniejszych metod moÅ¼emy wymieniÄ‡:

- Dokument HTML
- Element z pozycjÄ… `relative` / `abosolute` + `z-index` (inne niÅ¼ `auto`)
- Element z pozycjÄ… `sticky` / `fixed`
- Dziecko elementu, ktÃ³ry ma `display` ustawiony na `flex` / `grid`
- Element z `opacity` mniejszym niÅ¼ `1`

CaÅ‚Ä… listÄ™ znajdziesz w [dokumentacji MDN](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context#description).

## KolejnoÅ›Ä‡ uÅ‚oÅ¼enia w Stacking Context

UdaÅ‚o nam siÄ™ stworzyÄ‡ nowÄ… _warstwÄ™_, ale nadal coÅ› nie dziaÅ‚a? ğŸ¤¬

Elementy znajdujÄ…ce siÄ™ w obrÄ™bie danej _warstwy_ ukÅ‚adane bÄ™dÄ… wzglÄ™dem danej kolejnoÅ›ci:

1. Wypozycjonowane elementy z negatywnym `z-index`
2. Elementy z `position: static`
3. Wypozycjonowane elementy z `z-index: auto`
4. Wypozycjonowane elementy z pozytywnym lub zerowym `z-index`

<Image src="/images/css-stacking-context/sc-5.png" alt="" />

## Praktyczny przykÅ‚ad

WrÃ³Ä‡my do naszego poczÄ…tkowego problemu. W naszym sklepie nawigacja ma siÄ™ znajdowaÄ‡ pod, a koszyk nad resztÄ… elementÃ³w.

<Image src="/images/css-stacking-context/ecommerce-broken.png" alt="" />

Tworzymy odpowiedniÄ… strukturÄ™ HTML i nadajemy elementom odpowiednie `z-index`. Elementowi z klasÄ… `.main` przypisujemy wiÄ™kszy `z-index`, niÅ¼ elementowi z klasÄ… `.header`. _Header_ jest rodzicem koszyka, wiÄ™c dodatkowo nadajemy mu `position: relative` - dziÄ™ki temu bÄ™dziemy mogli swobodnie umiejscowiÄ‡ koszyk za pomocÄ… `position: absolute`.

```html
<style>
  .header {
    position: relative;
    z-index: 1;
  }

  .cart {
    position: abosolute;
    top: 5rem;
    right: 5rem;
    z-index: 999999;
  }

  .main {
    position: relative;
    z-index: 10;
    transform: translateY(-50px);
  }
</style>

<body>
  <header class="header">
    <nav></nav>
    <div class="cart"></div>
  </header>
  <main class="main">
    <aside></aside>
    <ul></ul>
  </main>
</body>
```

**Widzisz problem?** ğŸ¤”

Element z klasÄ… `.header` stworzyÅ‚ nowy _stacking context_. Aby poprawiÄ‡ wyglÄ…d naszego sklepu, potrzebujemy pozbyÄ‡ siÄ™ nowo utworzonej warsty. Kasujemy zbÄ™dny `z-index: 1` z _header_ i wyszystko zaczÄ™Å‚o Å›migaÄ‡!

Od teraz warstwy koszyka i elementu z klasÄ… `<main>` sÄ… na tym samym poziomie - dlatego moÅ¼emy je bez obaw z sobÄ… porÃ³wnywaÄ‡.

```css
.header {
  position: relative;
}

.cart {
  position: absolute;
  top: 5rem;
  right: 5rem;
  z-index: 2;
}

.main {
  position: relative;
  z-index: 1;
  transform: translateY(-50px);
}
```

UproÅ›ciÅ‚em rÃ³wnieÅ¼ wartoÅ›ci `z-index` - dbaj o swoje _z-indexy_ i nie nadawaj im nieskoÅ„czonych wrÄ™cz wartoÅ›ci. Zobacz jak utrzymywaÄ‡ w porzÄ…dku swoje `z-index` - [Managing CSS Z-Index In Large Projects
](https://www.smashingmagazine.com/2021/02/css-z-index-large-projects/)

<Image src="/images/css-stacking-context/ecommerce-fixed.png" alt="" />

## Warstwy w izolacji

WyobraÅº sobie sytuacjÄ™, w ktÃ³rej tworzysz jakiÅ› reuÅ¼ywaly kawaÅ‚ek strony. W naszym przypadku niech to bÄ™dzie kafelek przedmiotu. WystÄ™puje on na stronie gÅ‚Ã³wnej, ale wyÅ›wietla siÄ™ rÃ³wnieÅ¼ na stronie z danÄ… kategoriÄ…. Od dziÅ› kaÅ¼da taka karta bÄ™dzie miaÅ‚a w tle grafikÄ™ SVG.

Potrzebujemy wypozycjonowaÄ‡ SVG tak, Å¼eby znajdowaÅ‚o siÄ™ pod resztÄ… elementÃ³w. Jazda, dodajemy negatywny `z-index` i gotowe! Nie do koÅ„ca, nasza grafika zniknÄ™Å‚a z pola naszego widzenia - znajduje siÄ™ pod samÄ… kartÄ….

<Image src="/images/css-stacking-context/isolation-broken.png" alt="" />

JeÅ›li pomyÅ›laÅ‚eÅ› o _stacking context_, to masz w 100% racje, musimy go stworzyÄ‡!

Mamy naprawdÄ™ mnÃ³stwo metod, dziÄ™ki ktÃ³rym stworzymy nowÄ… warstÄ™. Problem jest tylko taki, Å¼e karta ma byÄ‡ reuÅ¼ywalna. Nie chcemy jej wprost podaÄ‡ `z-index`, bo nie wiemy jak bÄ™dzie siÄ™ zachowywaÅ‚a na innych stronach.

CaÅ‚e na biaÅ‚o w takich przypadkach wjeÅ¼dÅ¼a `isolation: isolate` w CSS. Pozwala nam ono stworzyÄ‡ nowy _stacking context_ bez Å¼adnych skutkÃ³w ubocznych. Åšwietna alternatywa dla innych sposÃ³bÃ³w, ktÃ³re w przeciwieÅ„stwie do `isolation`, posiadajÄ… nieporzÄ…dane efekty :)

<Image src="/images/css-stacking-context/isolation-fixed.png" alt="" />

## Podsumowanie

Ustawianie elementÃ³w za pomocÄ… `z-index` potrafi byÄ‡ naprawdÄ™ upierdliwe... Zrozumienie konceptu _stacking context_ to podstawa do unikniÄ™ca drogich wizyt u psychologa.

Do usÅ‚yszenia!

### Å¹rÃ³dÅ‚a

- [MDN - CSS Stacking Context](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context#description)
- [MDN - CSS Isolation](https://developer.mozilla.org/en-US/docs/Web/CSS/isolation)
- [MDN - Stacking without the z-index property](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/Stacking_without_z-index)
- [Philip Walton - What No One Told You About Z-Index](https://philipwalton.com/articles/what-no-one-told-you-about-z-index/)
- [Smashing Magazine - Managing CSS Z-Index In Large Projects](https://www.smashingmagazine.com/2021/02/css-z-index-large-projects/)
